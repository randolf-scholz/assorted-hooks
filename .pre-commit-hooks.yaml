# Custom hooks for pre-commit.


# region scripts -----------------------------------------------------------------------
- id: pyproject-validate-version
  description: "Validate python version (PEP-440)."
  entry: "./src/assorted_hooks/scripts/pyproject_validate_version.py"
  files: ^pyproject\.toml$
  language: script
  name: pyproject-validate-version
  types: [toml]
- id: pyproject-update-deps
  description: "Update dependencies to >=currently_installed. (default: manual)"
  entry: "./src/assorted_hooks/scripts/pyproject_update_dependencies.py"
  files: ^pyproject\.toml$
  language: script
  name: pyproject-update-deps
  stages: [manual]
  types: [toml]
- id: pyproject-check-deps
  description: "Check that listed dependencies are used in code and vice-versa."
  entry: "./src/assorted_hooks/scripts/pyproject_check_dependencies.py"
  files: ^pyproject\.toml$
  language: script
  name: pyproject-check-deps
  types: [toml]
- id: python-check-clean-interface
  description: "Check for clean interface."
  entry: "./src/assorted_hooks/scripts/check_clean_interface.py"
  language: script
  name: python-check-clean-interface
  require_serial: true # otherwise module is loaded multiple times
  types: [python]
# endregion scripts --------------------------------------------------------------------


# region pygrep ------------------------------------------------------------------------
- id: check-separator-length
  name: check-separator-length
  entry: ^#(.{0,83}|.{85,})([-=═─—])\2{2}$
  language: pygrep
  types: [python]
  description: "Check that 'line-break'-comments are the right length (default: 88)."
- id: python-no-blanket-type-ignore
  name: python-no-blanket-type-ignore
  entry: '.# *type: *ignore(?!\[)'
  language: pygrep
  types: [python]
  description: "Enforce that `# type: ignore` annotations always specify codes."
- id: python-no-builtin-eval
  name: python-no-builtin-eval
  entry: '(?<!def\s)(?<!\.)\b(builtins\.)?(eval\()'
  language: pygrep
  types: [python]
  description: "Disallows eval() but allows obj.eval()."
- id: python-consider-using-raw-string
  name: python-consider-using-raw-string
  entry: '\s+"""\S'
  language: pygrep
  types: [python]
  description: "Checks that triple quoted strings are raw (docstrings)."
# endregion pygrep ---------------------------------------------------------------------


# region ast-based ---------------------------------------------------------------------
- id: python-direct-imports
  name: python-direct-imports
  entry: check-direct-imports
  language: python
  types: [python]
  description: "Checks that Bar is used instead of foo.Bar if both foo and Bar are imported."
- id: python-no-mixed-args
  name: python-no-mixed-args
  entry: check-no-mixed-args
  language: python
  types: [python]
  description: "Check for disallowing positional_or_keyword arguments."
- id: python-standard-generics
  name: python-standard-generics
  entry: check-standard-generics
  language: python
  types: [python]
  description: "Use standard generics (PEP-585): typing.Sequence -> abc.Sequence, typing.List -> list."
- id: python-dunder-all
  name: python-dunder-all
  entry: check-dunder-all
  language: python
  types: [python]
  exclude: '^(.*\/)?test_.*\.py$'
  description: "Check that __all__ exists. `test_*.py` files are excluded by default."
- id: python-check-typing
  name: python-check-typing
  entry: check-typing
  language: python
  types: [python]
  description: "AST-based linting rule for type-hints."
# endregion ast-based ------------------------------------------------------------------


# region latex -------------------------------------------------------------------------
- id: chktex
  name: chktex
  language: system
  types: [tex]
  description: "ChkTeX, a LaTeX semantic checker."
  entry: "chktex --format='%f:%l:%c %m [%k %n]\n' --quiet"
  args:  # default configuration
    - "--erroron=all"
    - "--nowarn=1"   # Command terminated with space.
    - "--nowarn=3"   # Enclose previous parentheses with `{}`.
    - "--nowarn=19"  # Use "’" (ASCII 39) instead of "’" (ASCII 180) [reason: unicode]
    - "--nowarn=21"  # `\TeX.` instead of `\TeX\.` [reason: false positive `\},`]
    - "--nowarn=22"  # used for displaying comments in the output
    - "--nowarn=46"  # Use \(...\) in text mode instead of $...$.
  # region previous configuration ------------------------------------------------------
  #  args:
  #    - "--format=%f:%l:%c %m [%k %n]\n"
  #    - "--quiet"
  #    - "--erroron=all"
  #    - "--nowarn=1"   # Command terminated with space.
  #    - "--nowarn=3"   # Enclose previous parentheses with `{}`.
  #    - "--nowarn=19"  # Use "’" (ASCII 39) instead of "’" (ASCII 180) [reason: unicode]
  #    - "--nowarn=21"  # `\TeX.` instead of `\TeX\.` [reason: false positive `\},`]
  #    - "--nowarn=22"  # used for displaying comments in the output
  #    - "--nowarn=30"  # tabs vs spaces
  #    - "--nowarn=41"  # TeX primitives should not be used
  #    - "--nowarn=44"  # vertical rules in tables are ugly.
  #    - "--nowarn=46"  # Use \(...\) in text mode instead of $...$.
  #    - "--"  # otherwise files are interpreted as args
  # endregion previous configuration ---------------------------------------------------
- id: lacheck
  name: lacheck
  description: "A consistency checker for LaTeX documents"
  language: system
  types: [tex]
  files: \.tex$
  entry: bash -c '! printf "%s\n" "$@" | xargs -I _ lacheck _ | grep .' --
  # NOTE: lacheck only takes a single file at a time, so we need to use xargs
  # NOTE: lacheck always returns 0, so we need to grep for output
  # NOTE: grep has exit code 1 if no matches are found, so we need to invert with `!`
  # NOTE: We add a `--` to the end of the command to ensure that no filenames are interpreted as arguments
# endregion latex ----------------------------------------------------------------------
